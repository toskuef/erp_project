{% load widget_tweaks %}
<form action="{% url 'crm:crm_customer_detail' customer.pk %}" method="post">
  {% csrf_token %}
  <div class="d-flex justify-content-between">
    <div class="list-group-item border-0 ps-0 text-sm"><strong
            class="text-dark">Страна</strong></div>
    <template id="country_template">
      {% for c in country %}
        <option value="{{ c }}">{{ c }}</option>
      {% endfor %}
    </template>
    {% render_field country_form.country_title type="text" name="country" id="country" placeholder="Страна" list="country_results" autocomplete="off" class='form-control form-control-sm mb-2 w-50' %}
    <datalist id="country_results"></datalist>
  </div>


    <div class="d-flex justify-content-between">
    <div class="list-group-item border-0 ps-0 text-sm"><strong
            class="text-dark">Область</strong></div>
      <template id="area_template">
      {% for a in area %}
        <option>{{ a }}</option>
      {% endfor %}
    </template>
  {% render_field area_form.area_title type="text" name="area" id="area" placeholder="Область" list="area_results" autocomplete="off" class='form-control form-control-sm mb-2 w-50' %}
       <datalist id="area_results"></datalist>
        </div>


    <div class="d-flex justify-content-between">
    <div class="list-group-item border-0 ps-0 text-sm"><strong
            class="text-dark">Район</strong></div>
      <template id="region_template">
      {% for r in region %}
        <option>{{ r }}</option>
      {% endfor %}
    </template>
  {% render_field region_form.region_title type="text" name="region" id="region" placeholder="Регион" list="region_results" autocomplete="off" class='form-control form-control-sm mb-2 w-50' %}
    <datalist id="region_results"></datalist>
    </div>


    <div class="d-flex justify-content-between">
    <div class="list-group-item border-0 ps-0 text-sm"><strong
            class="text-dark">Город</strong></div>
      <template id="town_template">
      {% for t in town %}
        <option>{{ t }}</option>
      {% endfor %}
    </template>
  {% render_field town_form.town_title type="text" name="town" id="town" placeholder="Город" list="town_results" autocomplete="off" class='form-control form-control-sm mb-2 w-50' %}
    <datalist id="town_results"></datalist>
    </div>


    <div class="d-flex justify-content-between">
    <div class="list-group-item border-0 ps-0 text-sm"><strong
            class="text-dark">Улица</strong></div>
      <template id="street_template">
      {% for s in street %}
        <option>{{ s }}</option>
      {% endfor %}
    </template>
  {% render_field street_form.street_title type="text" name="street" id="street" placeholder="Улица" list="street_results" autocomplete="off" class='form-control form-control-sm mb-2 w-50' %}
    <datalist id="street_results"></datalist>
    </div>


    <div class="d-flex justify-content-between">
    <div class="list-group-item border-0 ps-0 text-sm"><strong
            class="text-dark">Дом</strong></div>
  {% render_field address_form.num_house class='form-control form-control-sm mb-2 w-50' %}
        </div>
    <div class="d-flex justify-content-between">
    <div class="list-group-item border-0 ps-0 text-sm"><strong
            class="text-dark">Корпус</strong></div>
  {% render_field address_form.num_housing class='form-control form-control-sm mb-2 w-50' %}
        </div>
    <div class="d-flex justify-content-between">
    <div class="list-group-item border-0 ps-0 text-sm"><strong
            class="text-dark">Подъезд</strong></div>
  {% render_field address_form.num_door class='form-control form-control-sm mb-2 w-50' %}
        </div>
    <div class="d-flex justify-content-between">
    <div class="list-group-item border-0 ps-0 text-sm"><strong
            class="text-dark">Этаж</strong></div>
  {% render_field address_form.num_level class='form-control form-control-sm mb-2 w-50' %}
        </div>
    <div class="d-flex justify-content-between">
    <div class="list-group-item border-0 ps-0 text-sm"><strong
            class="text-dark">Номер квартиры</strong></div>
  {% render_field address_form.num_flat class='form-control form-control-sm mb-2 w-50' %}
    </div>
  <div class="d-flex justify-content-between">
  <button class="btn btn-light" type="submit">Сохранить</button>
  <a class="btn btn-dark" href="{% url 'crm:crm_customer_detail' customer.pk %}">Отмена</a>
  </div>
</form>

  <script>
      var country = document.querySelector('#country');
      var country_results = document.querySelector('#country_results');
      var country_template = document.querySelector('#country_template').content;
      country.addEventListener('keyup', function handler(event) {
          while (country_results.children.length) country_results.removeChild(country_results.firstChild);
          var country_inputVal = new RegExp(country.value.trim(), 'i');
          var country_clonedOptions = country_template.cloneNode(true);
          var country_set = Array.prototype.reduce.call(country_clonedOptions.children, function searchFilter(frag, el) {
              if (country_inputVal.test(el.textContent) && frag.children.length < 5) frag.appendChild(el);
              return frag;
          }, document.createDocumentFragment());
          country_results.appendChild(country_set);
      });

      var area = document.querySelector('#area');
      var area_results = document.querySelector('#area_results');
      var area_template = document.querySelector('#area_template').content;
      area.addEventListener('keyup', function handler(event) {
          while (area_results.children.length) area_results.removeChild(area_results.firstChild);
          var area_inputVal = new RegExp(area.value.trim(), 'i');
          var area_clonedOptions = area_template.cloneNode(true);
          var area_set = Array.prototype.reduce.call(area_clonedOptions.children, function searchFilter(frag, el) {
              if (area_inputVal.test(el.textContent) && frag.children.length < 5) frag.appendChild(el);
              return frag;
          }, document.createDocumentFragment());
          area_results.appendChild(area_set);
      });

      var region = document.querySelector('#region');
      var region_results = document.querySelector('#region_results');
      var region_template = document.querySelector('#region_template').content;
      region.addEventListener('keyup', function handler(event) {
          while (region_results.children.length) region_results.removeChild(region_results.firstChild);
          var region_inputVal = new RegExp(region.value.trim(), 'i');
          var region_clonedOptions = region_template.cloneNode(true);
          var region_set = Array.prototype.reduce.call(region_clonedOptions.children, function searchFilter(frag, el) {
              if (region_inputVal.test(el.textContent) && frag.children.length < 5) frag.appendChild(el);
              return frag;
          }, document.createDocumentFragment());
          region_results.appendChild(region_set);
      });

      var town = document.querySelector('#town');
      var town_results = document.querySelector('#town_results');
      var town_template = document.querySelector('#town_template').content;
      town.addEventListener('keyup', function handler(event) {
          while (town_results.children.length) town_results.removeChild(town_results.firstChild);
          var town_inputVal = new RegExp(town.value.trim(), 'i');
          var town_clonedOptions = town_template.cloneNode(true);
          var town_set = Array.prototype.reduce.call(town_clonedOptions.children, function searchFilter(frag, el) {
              if (town_inputVal.test(el.textContent) && frag.children.length < 5) frag.appendChild(el);
              return frag;
          }, document.createDocumentFragment());
          town_results.appendChild(town_set);
      });

      var street = document.querySelector('#street');
      var street_results = document.querySelector('#street_results');
      var street_template = document.querySelector('#street_template').content;
      street.addEventListener('keyup', function handler(event) {
          while (street_results.children.length) street_results.removeChild(street_results.firstChild);
          var street_inputVal = new RegExp(street.value.trim(), 'i');
          var street_clonedOptions = street_template.cloneNode(true);
          var street_set = Array.prototype.reduce.call(street_clonedOptions.children, function searchFilter(frag, el) {
              if (street_inputVal.test(el.textContent) && frag.children.length < 5) frag.appendChild(el);
              return frag;
          }, document.createDocumentFragment());
          street_results.appendChild(street_set);
      });
  </script>
